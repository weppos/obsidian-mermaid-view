var p=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var u=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var f=(r,t)=>{for(var e in t)p(r,e,{get:t[e],enumerable:!0})},x=(r,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of u(t))!y.call(r,s)&&s!==e&&p(r,s,{get:()=>t[s],enumerable:!(i=E(t,s))||i.enumerable});return r};var M=r=>x(p({},"__esModule",{value:!0}),r);var T={};f(T,{default:()=>m});module.exports=M(T);var v=require("obsidian");var a=require("obsidian"),d="mermaid-view",n=class extends a.TextFileView{constructor(e,i){super(e);this.mode="preview";this.plugin=i}getViewType(){return d}getDisplayText(){var e,i;return(i=(e=this.file)==null?void 0:e.basename)!=null?i:"Mermaid Diagram"}getIcon(){return"git-branch"}async onOpen(){let e=this.contentEl;e.empty(),e.addClass("mermaid-view-container"),this.previewEl=e.createDiv({cls:"mermaid-view-preview"}),this.sourceEl=e.createDiv({cls:"mermaid-view-source"}),this.editorEl=this.sourceEl.createEl("textarea"),this.editorEl.addClass("mermaid-view-editor"),this.editorEl.spellcheck=!1,this.editorEl.style.width="100%",this.editorEl.style.height="100%",this.editorEl.style.resize="none",this.editorEl.style.border="none",this.editorEl.style.outline="none",this.editorEl.style.padding="20px",this.editorEl.style.fontFamily="var(--font-monospace)",this.editorEl.style.fontSize="var(--font-text-size)",this.editorEl.style.backgroundColor="var(--background-primary)",this.editorEl.style.color="var(--text-normal)",this.editorEl.style.boxSizing="border-box",this.editorEl.addEventListener("input",()=>{this.data=this.editorEl.value,this.requestSave()}),this.addAction("code","Toggle source/preview",()=>{this.toggleMode()}),this.setMode("preview")}async onClose(){this.contentEl.empty()}getViewData(){return this.data}setViewData(e,i){this.data=e,this.editorEl.value=e,this.mode==="preview"&&this.renderPreview()}clear(){this.data="",this.editorEl.value="",this.previewEl.empty()}setMode(e){var s;this.mode=e,e==="preview"?(this.sourceEl.hide(),this.previewEl.show(),this.renderPreview()):(this.previewEl.hide(),this.sourceEl.show(),this.editorEl.value=this.data,this.editorEl.focus());let i=(s=this.contentEl.parentElement)==null?void 0:s.querySelector('.view-action[aria-label="Toggle source/preview"]');i&&(i.empty(),(0,a.setIcon)(i,e==="preview"?"code":"eye"))}toggleMode(){this.setMode(this.mode==="preview"?"source":"preview")}async renderPreview(){var o,c;this.previewEl.empty();let e=this.data.trim();if(!e){this.previewEl.createDiv({cls:"mermaid-view-empty",text:"Empty diagram. Switch to source mode to add content."});return}let i=this.previewEl.createDiv(),s="```mermaid\n"+e+"\n```";try{await a.MarkdownRenderer.render(this.app,s,i,(c=(o=this.file)==null?void 0:o.path)!=null?c:"",this)}catch(w){this.previewEl.empty(),this.previewEl.createDiv({cls:"mermaid-view-error",text:`Error rendering diagram:
${w}`})}}};var h=require("obsidian"),g={extensions:["mermaid","mmd"]},l=class extends h.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new h.Setting(t).setName("File extensions").setDesc("Comma-separated list of file extensions to treat as Mermaid files (without the dot). Changes require restarting Obsidian.").addText(e=>e.setPlaceholder("mermaid, mmd").setValue(this.plugin.settings.extensions.join(", ")).onChange(async i=>{let s=i.split(",").map(o=>o.trim().toLowerCase()).filter(o=>o.length>0);this.plugin.settings.extensions=s,await this.plugin.saveSettings()})),t.createEl("p",{text:"Note: After changing extensions, you need to restart Obsidian for the changes to take effect.",cls:"setting-item-description"})}};var m=class extends v.Plugin{async onload(){await this.loadSettings(),this.registerView(d,t=>new n(t,this)),this.registerExtensions(this.settings.extensions,d),this.addSettingTab(new l(this.app,this)),this.addCommand({id:"toggle-mermaid-mode",name:"Toggle source/preview mode",checkCallback:t=>{let e=this.app.workspace.getActiveViewOfType(n);return e?(t||e.toggleMode(),!0):!1}})}onunload(){}async loadSettings(){this.settings=Object.assign({},g,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
